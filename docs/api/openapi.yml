openapi: 3.1.0
info:
  title: Hekatoncheiros Core API
  version: "0.1.1"
  description: >
    Core platform kernel API (draft). Versioned under /api/v1.
    Requests are tenant-contextual and privilege-checked by the core.

servers:
  - url: https://{host}/api/v1
    variables:
      host:
        default: localhost

tags:
  - name: Context
  - name: Licensing
  - name: Apps
  - name: Events
  - name: Audit

paths:
  /context:
    get:
      tags: [Context]
      summary: Get resolved request context for the current actor and tenant.
      operationId: getContext
      security:
        - bearerAuthUser: []
      x-required-privileges: [] # authenticated user only
      responses:
        "200":
          description: Context resolved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ContextResponse"
        "401":
          $ref: "#/components/responses/Unauthorized"

  /licensing/apps/{app_id}:
    get:
      tags: [Licensing]
      summary: Get licensing state and entitlements for a specific app for current tenant.
      operationId: getAppLicense
      parameters:
        - $ref: "#/components/parameters/AppId"
      security:
        - bearerAuthUser: []
      x-required-privileges:
        - "core.licensing.read"
      responses:
        "200":
          description: License state
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AppLicense"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /licensing/apps/{app_id}/activate-offline:
    post:
      tags: [Licensing]
      summary: Activate offline license for an app (tenant admin only).
      operationId: activateOfflineLicense
      parameters:
        - $ref: "#/components/parameters/AppId"
      security:
        - bearerAuthUser: []
      x-required-privileges:
        - "core.licensing.activate_offline"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/OfflineLicenseActivationRequest"
      responses:
        "200":
          description: License activated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AppLicense"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /apps/register:
    post:
      tags: [Apps]
      summary: Register an app version/manifest (platform admin only).
      operationId: registerApp
      security:
        - bearerAuthUser: []
      x-required-privileges:
        - "core.apps.register"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AppRegisterRequest"
      responses:
        "200":
          description: App registered
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AppRegisterResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /tenants/apps/{app_id}/enable:
    post:
      tags: [Apps]
      summary: Enable an app for current tenant (tenant admin only).
      operationId: enableAppForTenant
      parameters:
        - $ref: "#/components/parameters/AppId"
      security:
        - bearerAuthUser: []
      x-required-privileges:
        - "core.apps.enable"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TenantAppEnableRequest"
      responses:
        "200":
          description: Enabled state
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TenantAppState"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /tenants/apps/{app_id}/disable:
    post:
      tags: [Apps]
      summary: Disable an app for current tenant (tenant admin only).
      operationId: disableAppForTenant
      parameters:
        - $ref: "#/components/parameters/AppId"
      security:
        - bearerAuthUser: []
      x-required-privileges:
        - "core.apps.disable"
      responses:
        "204":
          description: Disabled
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /events/publish:
    post:
      tags: [Events]
      summary: Publish an event (app identity only).
      operationId: publishEvent
      security:
        - bearerAuthApp: []
      x-required-privileges: [] # app-auth only, no user privilege
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EventPublishRequest"
      responses:
        "200":
          description: Event accepted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EventPublishResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /events/consume:
    post:
      tags: [Events]
      summary: Consume next events for a consumer (app identity only).
      operationId: consumeEvents
      security:
        - bearerAuthApp: []
      x-required-privileges: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EventConsumeRequest"
      responses:
        "200":
          description: Events batch
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EventConsumeResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /events/ack:
    post:
      tags: [Events]
      summary: Acknowledge processed events (app identity only).
      operationId: acknowledgeEvents
      security:
        - bearerAuthApp: []
      x-required-privileges: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EventAckRequest"
      responses:
        "204":
          description: Acknowledged
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /audit/record:
    post:
      tags: [Audit]
      summary: Append an audit record (apps and core subsystems).
      operationId: recordAudit
      security:
        - bearerAuthApp: []
        - bearerAuthUser: []
      x-required-privileges:
        - "core.audit.append" # for user-auth; app-auth bypasses user privilege by definition
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AuditRecordRequest"
      responses:
        "204":
          description: Recorded
        "400":
          $ref: "#/components/responses/BadRequest"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

components:
  securitySchemes:
    bearerAuthUser:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: User access token (human actor).
    bearerAuthApp:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: App identity token (service-to-core).

  # keep the rest of components (parameters/responses/schemas) from v0.1.0 unchanged
